<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;" id="rrspContribLabel">RRSP Contribution (Monthly) ($)</label>
                        <input type="number" id="rrspContribution" value="500" min="0" step="50" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;" id="tfsaContribLabel">TFSA Contribution (Monthly) ($)</label>
                        <input type="number" id="tfsaContribution" value="300" min="0" step="50" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                    </div>
                </div>
                
                <h3 style="color: #2c3e50; margin: 30px 0 20px 0; font-size: 1.3rem;">Assumptions</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Expected Annual Return (%)</label>
                        <select id="investmentReturn" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                            <option value="4">Conservative (4%)</option>
                            <option value="6" selected>Moderate (6%)</option>
                            <option value="8">Aggressive (8%)</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Inflation Rate (%)</label>
                        <select id="inflationRate" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                            <option value="2" selected>Low (2%)</option>
                            <option value="2.5">Moderate (2.5%)</option>
                            <option value="3">High (3%)</option>
                        </select>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Government Benefits (OAS + CPP) ($)</label>
                    <input type="number" id="govBenefits" value="18000" min="0" step="1000" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                </div>
                
                <div style="display: flex; align-items: center; gap: 10px; margin: 20px 0;">
                    <input type="checkbox" id="includeSpouse" style="transform: scale(1.2);">
                    <label for="includeSpouse" style="font-weight: 600; color: #34495e;">Include Spouse</label>
                </div>
                
                <div id="spouseSection" class="hidden" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px; border-left: 4px solid #667eea;">
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">Spouse Information</h4>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Spouse Full Name</label>
                        <input type="text" id="spouseName" placeholder="Enter spouse's full name" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Spouse Current Age</label>
                            <input type="number" id="spouseAge" value="43" min="25" max="100" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Spouse Retirement Age</label>
                            <input type="number" id="spouseRetirementAge" value="65" min="50" max="80" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Spouse RRSP ($)</label>
                            <input type="number" id="spouseRRSP" value="120000" min="0" step="1000" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Spouse TFSA ($)</label>
                            <input type="number" id="spouseTFSA" value="60000" min="0" step="1000" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;" id="spouseRRSPContribLabel">Spouse RRSP Contribution (Monthly) ($)</label>
                            <input type="number" id="spouseRRSPContrib" value="400" min="0" step="50" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;" id="spouseTFSAContribLabel">Spouse TFSA Contribution (Monthly) ($)</label>
                            <input type="number" id="spouseTFSAContrib" value="250" min="0" step="50" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Spouse Non-Reg ($)</label>
                            <input type="number" id="spouseNonReg" value="30000" min="0" step="1000" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Spouse Pension ($)</label>
                            <input type="number" id="spousePension" value="8000" min="0" step="1000" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Spouse Gov Benefits ($)</label>
                        <input type="number" id="spouseGovBenefits" value="16000" min="0" step="1000" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                    </div>
                </div>
                
                <button onclick="calculateRetirement()" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 15px 30px; font-size: 1.1rem; font-weight: 600; border-radius: 10px; cursor: pointer; width: 100%; margin-top: 20px; transition: transform 0.2s ease;">
                    Calculate Retirement Income 🚀
                </button>
            `;
            
            // Add event listeners
            document.getElementById('includeSpouse').addEventListener('change', function() {
                const spouseSection = document.getElementById('spouseSection');
                if (this.checked) {
                    spouseSection.classList.remove('hidden');
                } else {
                    spouseSection.classList.add('hidden');
                }
            });
            
            document.getElementById('contributionFrequency').addEventListener('change', function() {
                const frequency = this.value;
                const isMonthly = frequency === 'monthly';
                
                document.getElementById('rrspContribLabel').textContent = 
                    `RRSP Contribution (${isMonthly ? 'Monthly' : 'Annual'}) ($)`;
                document.getElementById('tfsaContribLabel').textContent = 
                    `TFSA Contribution (${isMonthly ? 'Monthly' : 'Annual'}) ($)`;
                document.getElementById('spouseRRSPContribLabel').textContent = 
                    `Spouse RRSP Contribution (${isMonthly ? 'Monthly' : 'Annual'}) ($)`;
                document.getElementById('spouseTFSAContribLabel').textContent = 
                    `Spouse TFSA Contribution (${isMonthly ? 'Monthly' : 'Annual'}) ($)`;
            });
        }
        
        // Calculator Functions
        function calculateRetirement() {
            // Get all input values
            const clientName = document.getElementById('clientName').value.trim() || 'Client';
            const currentAge = parseInt(document.getElementById('currentAge').value);
            const retirementAge = parseInt(document.getElementById('retirementAge').value);
            const lifeExpectancy = parseInt(document.getElementById('lifeExpectancy').value);
            
            const rrsp = parseFloat(document.getElementById('rrsp').value) || 0;
            const tfsa = parseFloat(document.getElementById('tfsa').value) || 0;
            const nonReg = parseFloat(document.getElementById('nonReg').value) || 0;
            const pensionIncome = parseFloat(document.getElementById('pensionIncome').value) || 0;
            const govBenefits = parseFloat(document.getElementById('govBenefits').value) || 0;
            
            const contributionFrequency = document.getElementById('contributionFrequency').value;
            const isMonthly = contributionFrequency === 'monthly';
            
            let rrspContribution = parseFloat(document.getElementById('rrspContribution').value) || 0;
            let tfsaContribution = parseFloat(document.getElementById('tfsaContribution').value) || 0;
            
            if (isMonthly) {
                rrspContribution *= 12;
                tfsaContribution *= 12;
            }
            
            const investmentReturn = parseFloat(document.getElementById('investmentReturn').value) / 100;
            const inflationRate = parseFloat(document.getElementById('inflationRate').value) / 100;
            const includeSpouse = document.getElementById('includeSpouse').checked;
            
            const yearsToRetirement = retirementAge - currentAge;
            const yearsInRetirement = lifeExpectancy - retirementAge;
            
            if (yearsToRetirement <= 0) {
                alert('Retirement age must be greater than current age');
                return;
            }
            
            // Calculate future values
            const futureValueRRSP = calculateFutureValueWithContributions(rrsp, rrspContribution, investmentReturn, yearsToRetirement);
            const futureValueTFSA = calculateFutureValueWithContributions(tfsa, tfsaContribution, investmentReturn, yearsToRetirement);
            const futureValueNonReg = nonReg * Math.pow(1 + investmentReturn, yearsToRetirement);
            
            const totalFutureValue = futureValueRRSP + futureValueTFSA + futureValueNonReg;
            const withdrawalRate = 0.04;
            const annualWithdrawalFromSavings = totalFutureValue * withdrawalRate;
            
            // Spouse calculations
            let spouseTotalFutureValue = 0;
            let spouseWithdrawal = 0;
            let spousePensionTotal = 0;
            let spouseGovTotal = 0;
            let spouseData = {};
            
            if (includeSpouse) {
                const spouseName = document.getElementById('spouseName').value.trim() || 'Spouse';
                const spouseAge = parseInt(document.getElementById('spouseAge').value);
                const spouseRetirementAge = parseInt(document.getElementById('spouseRetirementAge').value);
                const spouseRRSP = parseFloat(document.getElementById('spouseRRSP').value) || 0;
                const spouseTFSA = parseFloat(document.getElementById('spouseTFSA').value) || 0;
                const spouseNonReg = parseFloat(document.getElementById('spouseNonReg').value) || 0;
                spousePensionTotal = parseFloat(document.getElementById('spousePension').value) || 0;
                spouseGovTotal = parseFloat(document.getElementById('spouseGovBenefits').value) || 0;
                
                let spouseRRSPContrib = parseFloat(document.getElementById('spouseRRSPContrib').value) || 0;
                let spouseTFSAContrib = parseFloat(document.getElementById('spouseTFSAContrib').value) || 0;
                
                if (isMonthly) {
                    spouseRRSPContrib *= 12;
                    spouseTFSAContrib *= 12;
                }
                
                const spouseYearsToRetirement = Math.max(0, spouseRetirementAge - spouseAge);
                
                const spouseFutureRRSP = calculateFutureValueWithContributions(spouseRRSP, spouseRRSPContrib, investmentReturn, spouseYearsToRetirement);
                const spouseFutureTFSA = calculateFutureValueWithContributions(spouseTFSA, spouseTFSAContrib, investmentReturn, spouseYearsToRetirement);
                const spouseFutureNonReg = spouseNonReg * Math.pow(1 + investmentReturn, spouseYearsToRetirement);
                
                spouseTotalFutureValue = spouseFutureRRSP + spouseFutureTFSA + spouseFutureNonReg;
                spouseWithdrawal = spouseTotalFutureValue * withdrawalRate;
                
                spouseData = {
                    name: spouseName,
                    age: spouseAge,
                    retirementAge: spouseRetirementAge,
                    currentRRSP: spouseRRSP,
                    currentTFSA: spouseTFSA,
                    currentNonReg: spouseNonReg,
                    rrspContribution: spouseRRSPContrib,
                    tfsaContribution: spouseTFSAContrib,
                    yearsToRetirement: spouseYearsToRetirement
                };
            }
            
            const totalAnnualIncome = annualWithdrawalFromSavings + spouseWithdrawal + pensionIncome + spousePensionTotal + govBenefits + spouseGovTotal;
            const inflationAdjustedIncome = totalAnnualIncome / Math.pow(1 + inflationRate, yearsToRetirement);
            
            const currentTotalSavings = rrsp + tfsa + nonReg;
            const totalAnnualContributions = rrspContribution + tfsaContribution;
            
            // Store results globally
            calculationResults = {
                inputs: {
                    clientName,
                    currentAge,
                    retirementAge,
                    lifeExpectancy,
                    currentRRSP: rrsp,
                    currentTFSA: tfsa,
                    currentNonReg: nonReg,
                    rrspContribution,
                    tfsaContribution,
                    pensionIncome,
                    govBenefits,
                    investmentReturn: investmentReturn * 100,
                    inflationRate: inflationRate * 100,
                    contributionFrequency,
                    includeSpouse,
                    spouse: spouseData
                },
                calculations: {
                    totalIncome: inflationAdjustedIncome,
                    savingsWithdrawal: annualWithdrawalFromSavings / Math.pow(1 + inflationRate, yearsToRetirement),
                    spouseWithdrawal: spouseWithdrawal / Math.pow(1 + inflationRate, yearsToRetirement),
                    pensionIncome: pensionIncome,
                    spousePensionTotal: spousePensionTotal,
                    govBenefits: govBenefits,
                    spouseGovTotal: spouseGovTotal,
                    yearsToRetirement: yearsToRetirement,
                    yearsInRetirement: yearsInRetirement,
                    futureValueSavings: totalFutureValue,
                    spouseFutureValue: spouseTotalFutureValue,
                    currentSavings: currentTotalSavings,
                    totalAnnualContributions: totalAnnualContributions,
                    isMonthly: isMonthly
                }
            };
            
            displayResults(calculationResults.calculations);
        }
        
        function calculateFutureValueWithContributions(presentValue, annualContribution, rate, years) {
            if (years <= 0) return presentValue;
            
            const futureValueOfPresent = presentValue * Math.pow(1 + rate, years);
            const futureValueOfContributions = annualContribution * 
                ((Math.pow(1 + rate, years) - 1) / rate);
            
            return futureValueOfPresent + futureValueOfContributions;
        }
        
        function displayResults(data) {
            const resultsContainer = document.getElementById('calculatorResults');
            
            resultsContainer.innerHTML = `
                <h2 style="color: #2c3e50; margin-bottom: 25px; border-bottom: 3px solid #667eea; padding-bottom: 10px;">Your Retirement Plan</h2>
                
                <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border-left: 5px solid #27ae60;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.3rem;">Annual Retirement Income</h3>
                    <div style="font-size: 2.5rem; font-weight: bold; color: #27ae60; margin-bottom: 10px;">
                        ${Math.round(data.totalIncome).toLocaleString()}
                    </div>
                    <p style="color: #7f8c8d;">Adjusted for inflation</p>
                </div>
                
                <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border-left: 5px solid #27ae60;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.3rem;">Income Breakdown</h3>
                    <div id="breakdown"></div>
                </div>
                
                <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border-left: 5px solid #27ae60;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.3rem;">Summary</h3>
                    <div id="summary"></div>
                </div>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button onclick="saveCurrentCalculation()" style="background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; border: none; padding: 15px 30px; font-size: 1rem; font-weight: 600; border-radius: 10px; cursor: pointer; transition: transform 0.2s ease; flex: 1;">
                        💾 Save Calculation
                    </button>
                    <button onclick="generatePDF()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 15px 30px; font-size: 1rem; font-weight: 600; border-radius: 10px; cursor: pointer; transition: transform 0.2s ease; flex: 1;">
                        📄 Generate PDF
                    </button>
                </div>
            `;
            
            // Create breakdown
            const breakdown = document.getElementById('breakdown');
            const items = [
                { label: 'Investment Withdrawals', amount: data.savingsWithdrawal }
            ];
            
            if (calculationResults.inputs.includeSpouse && data.spouseWithdrawal > 0) {
                items.push({ label: 'Spouse Investment Withdrawals', amount: data.spouseWithdrawal });
            }
            
            if (data.pensionIncome > 0) {
                items.push({ label: 'Pension Income', amount: data.pensionIncome });
            }
            
            if (data.spousePensionTotal > 0) {
                items.push({ label: 'Spouse Pension Income', amount: data.spousePensionTotal });
            }
            
            if (data.govBenefits > 0) {
                items.push({ label: 'Government Benefits', amount: data.govBenefits });
            }
            
            if (data.spouseGovTotal > 0) {
                items.push({ label: 'Spouse Government Benefits', amount: data.spouseGovTotal });
            }
            
            let breakdownHTML = '';
            items.forEach(item => {
                breakdownHTML += `
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee;">
                        <span>${item.label}</span>
                        <span>${Math.round(item.amount).toLocaleString()}</span>
                    </div>
                `;
            });
            
            breakdownHTML += `
                <div style="display: flex; justify-content: space-between; padding: 15px 0 8px 0; border-top: 2px solid #2c3e50; margin-top: 10px; font-weight: bold;">
                    <span>Total Annual Income</span>
                    <span>${Math.round(data.totalIncome).toLocaleString()}</span>
                </div>
            `;
            
            breakdown.innerHTML = breakdownHTML;
            
            // Create summary
            const summary = document.getElementById('summary');
            const contributionDisplay = data.isMonthly ? 
                `${Math.round(data.totalAnnualContributions / 12).toLocaleString()}/month` : 
                `${Math.round(data.totalAnnualContributions).toLocaleString()}/year`;
            
            summary.innerHTML = `
                <p><strong>Years until retirement:</strong> ${data.yearsToRetirement}</p>
                <p><strong>Years in retirement:</strong> ${data.yearsInRetirement}</p>
                <p><strong>Current total savings:</strong> ${data.currentSavings.toLocaleString()}</p>
                <p><strong>Total contributions:</strong> ${contributionDisplay}</p>
                <p><strong>Projected savings at retirement:</strong> ${Math.round(data.futureValueSavings).toLocaleString()}</p>
                ${calculationResults.inputs.includeSpouse && data.spouseFutureValue > 0 ? 
                    `<p><strong>Spouse projected savings:</strong> ${Math.round(data.spouseFutureValue).toLocaleString()}</p>` : ''}
                <p style="margin-top: 15px; padding: 15px; background: #e8f5e8; border-radius: 8px; border-left: 4px solid #27ae60;">
                    <strong>💡 Note:</strong> All income figures are shown in today's purchasing power, adjusted for inflation. Contributions will compound over time!
                </p>
            `;
        }
        
        async function saveCurrentCalculation() {
            if (!calculationResults) {
                alert('Please calculate first!');
                return;
            }
            
            await saveCalculation(calculationResults.inputs, calculationResults.calculations);
        }
        
        function generatePDF() {
            if (!calculationResults) {
                alert('Please calculate your retirement income first!');
                return;
            }
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const pageWidth = doc.internal.pageSize.width;
                const pageHeight = doc.internal.pageSize.height;
                let yPosition = 20;
                
                function addText(text, x, y, maxWidth = pageWidth - 40) {
                    const lines = doc.splitTextToSize(text, maxWidth);
                    doc.text(lines, x, y);
                    return y + (lines.length * 6);
                }
                
                function checkNewPage(neededSpace = 20) {
                    if (yPosition + neededSpace > pageHeight - 20) {
                        doc.addPage();
                        yPosition = 20;
                        return true;
                    }
                    return false;
                }
                
                // Title
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                yPosition = addText('Retirement Income Calculation Report', 20, yPosition);
                yPosition += 5;
                
                // Client name(s)
                doc.setFontSize(16);
                doc.setFont(undefined, 'normal');
                const inputs = calculationResults.inputs;
                if (inputs.includeSpouse && inputs.spouse.name) {
                    yPosition = addText(`Prepared for: ${inputs.clientName} & ${inputs.spouse.name}`, 20, yPosition);
                } else {
                    yPosition = addText(`Prepared for: ${inputs.clientName}`, 20, yPosition);
                }
                yPosition += 10;
                
                // Date
                doc.setFontSize(12);
                doc.setFont(undefined, 'normal');
                const today = new Date().toLocaleDateString();
                yPosition = addText(`Generated on: ${today}`, 20, yPosition);
                yPosition += 15;
                
                // Results Section
                checkNewPage(60);
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                yPosition = addText('RETIREMENT INCOME PROJECTION', 20, yPosition);
                yPosition += 10;
                
                // Highlight the main result
                doc.setFillColor(240, 248, 255);
                doc.rect(15, yPosition - 5, pageWidth - 30, 25, 'F');
                
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                yPosition = addText(`Total Annual Retirement Income: ${Math.round(calculationResults.calculations.totalIncome).toLocaleString()}`, 20, yPosition);
                doc.setFontSize(10);
                doc.setFont(undefined, 'italic');
                yPosition = addText('(Adjusted for inflation - in today\'s purchasing power)', 20, yPosition + 5);
                yPosition += 15;
                
                // Save the PDF
                doc.save(`${inputs.clientName}_Retirement_Report.pdf`);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('There was an error generating the PDF. Please try again.');
            }
        }
        
        // Initialize app
        async function initializeApp() {
            // Check if user is already logged in
            const { data: { session } } = await supabase.auth.getSession();
            
            if (session) {
                currentUser = session.user;
                showDashboard();
            } else {
                showAuth();
            }
            
            // Listen for auth changes
            supabase.auth.onAuthStateChange((event, session) => {
                if (event === 'SIGNED_IN') {
                    currentUser = session.user;
                    showDashboard();
                } else if (event === 'SIGNED_OUT') {
                    currentUser = null;
                    showAuth();
                }
            });
        }
        
        // Additional functions for loading and duplicating calculations
        async function loadCalculation(id) {
            try {
                const { data, error } = await supabase
                    .from('calculations')
                    .select('*')
                    .eq('id', id)
                    .single();
                
                if (error) throw error;
                
                // Switch to calculator and populate with saved data
                showCalculator();
                
                // Wait for calculator to load, then populate fields
                setTimeout(() => {
                    populateCalculatorFields(data.calculation_data);
                }, 100);
                
            } catch (error) {
                console.error('Load calculation error:', error);
                alert('Error loading calculation');
            }
        }
        
        async function duplicateCalculation(id) {
            try {
                const { data, error } = await supabase
                    .from('calculations')
                    .select('*')
                    .eq('id', id)
                    .single();
                
                if (error) throw error;
                
                // Create a copy with modified name
                const originalName = data.client_name || 'Client';
                const copyData = {
                    ...data.calculation_data,
                    clientName: `${originalName} (Copy)`
                };
                
                // Switch to calculator and populate with copied data
                showCalculator();
                
                setTimeout(() => {
                    populateCalculatorFields(copyData);
                }, 100);
                
            } catch (error) {
                console.error('Duplicate calculation error:', error);
                alert('Error duplicating calculation');
            }
        }
        
        function populateCalculatorFields(data) {
            // Populate main fields
            if (data.clientName) document.getElementById('clientName').value = data.clientName;
            if (data.currentAge) document.getElementById('currentAge').value = data.currentAge;
            if (data.retirementAge) document.getElementById('retirementAge').value = data.retirementAge;
            if (data.lifeExpectancy) document.getElementById('lifeExpectancy').value = data.lifeExpectancy;
            if (data.currentRRSP) document.getElementById('rrsp').value = data.currentRRSP;
            if (data.currentTFSA) document.getElementById('tfsa').value = data.currentTFSA;
            if (data.currentNonReg) document.getElementById('nonReg').value = data.currentNonReg;
            if (data.pensionIncome) document.getElementById('pensionIncome').value = data.pensionIncome;
            if (data.govBenefits) document.getElementById('govBenefits').value = data.govBenefits;
            
            // Handle contribution frequency
            if (data.contributionFrequency) {
                document.getElementById('contributionFrequency').value = data.contributionFrequency;
                
                const isMonthly = data.contributionFrequency === 'monthly';
                const rrspContrib = isMonthly ? data.rrspContribution / 12 : data.rrspContribution;
                const tfsaContrib = isMonthly ? data.tfsaContribution / 12 : data.tfsaContribution;
                
                document.getElementById('rrspContribution').value = Math.round(rrspContrib);
                document.getElementById('tfsaContribution').value = Math.round(tfsaContrib);
            }
            
            if (data.investmentReturn) document.getElementById('investmentReturn').value = data.investmentReturn;
            if (data.inflationRate) document.getElementById('inflationRate').value = data.inflationRate;
            
            // Handle spouse data
            if (data.includeSpouse && data.spouse) {
                document.getElementById('includeSpouse').checked = true;
                document.getElementById('spouseSection').classList.remove('hidden');
                
                if (data.spouse.name) document.getElementById('spouseName').value = data.spouse.name;
                if (data.spouse.age) document.getElementById('spouseAge').value = data.spouse.age;
                if (data.spouse.retirementAge) document.getElementById('spouseRetirementAge').value = data.spouse.retirementAge;
                if (data.spouse.currentRRSP) document.getElementById('spouseRRSP').value = data.spouse.currentRRSP;
                if (data.spouse.currentTFSA) document.getElementById('spouseTFSA').value = data.spouse.currentTFSA;
                if (data.spouse.currentNonReg) document.getElementById('spouseNonReg').value = data.spouse.currentNonReg;
                
                const isMonthly = data.contributionFrequency === 'monthly';
                const spouseRRSPContrib = isMonthly ? data.spouse.rrspContribution / 12 : data.spouse.rrspContribution;
                const spouseTFSAContrib = isMonthly ? data.spouse.tfsaContribution / 12 : data.spouse.tfsaContribution;
                
                document.getElementById('spouseRRSPContrib').value = Math.round(spouseRRSPContrib);
                document.getElementById('spouseTFSAContrib').value = Math.round(spouseTFSAContrib);
                
                // These fields might not exist in older saved data
                if (document.getElementById('spousePension')) {
                    document.getElementById('spousePension').value = data.spousePensionTotal || 0;
                }
                if (document.getElementById('spouseGovBenefits')) {
                    document.getElementById('spouseGovBenefits').value = data.spouseGovTotal || 0;
                }
            }
        }
        
        // Start the application
        window.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
                }<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retirement Planning Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 80vh;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #4a6741);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .user-info {
            position: absolute;
            top: 20px;
            right: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-email {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* Auth Styles */
        .auth-container {
            max-width: 400px;
            margin: 0 auto;
            padding: 60px 40px;
            text-align: center;
        }
        
        .auth-title {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .input-group {
            text-align: left;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .auth-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .auth-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        
        .auth-switch {
            margin-top: 20px;
            color: #7f8c8d;
        }
        
        .auth-switch a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        
        .auth-switch a:hover {
            text-decoration: underline;
        }
        
        .error-message {
            background: #ffe6e6;
            color: #d63031;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #d63031;
        }
        
        .success-message {
            background: #e8f5e8;
            color: #27ae60;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #27ae60;
        }
        
        /* Dashboard Styles */
        .dashboard {
            padding: 40px;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .dashboard-title {
            font-size: 2rem;
            color: #2c3e50;
        }
        
        .dashboard-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #2c3e50;
            border: 2px solid #e1e8ed;
        }
        
        .calculations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .calculation-card {
            background: white;
            border: 2px solid #f1f3f4;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .calculation-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .card-date {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .card-info {
            margin-bottom: 15px;
        }
        
        .card-info p {
            margin-bottom: 5px;
            color: #34495e;
        }
        
        .card-income {
            font-size: 1.5rem;
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 15px;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        /* Calculator Integration */
        .calculator-embed {
            width: 100%;
            border: none;
            min-height: 800px;
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .dashboard-actions {
                justify-content: center;
            }
            
            .calculations-grid {
                grid-template-columns: 1fr;
            }
            
            .user-info {
                position: static;
                justify-content: center;
                margin-top: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Auth Section -->
    <div id="authSection" class="container">
        <div class="header">
            <h1>🏖️ Retirement Planning Portal</h1>
            <p>Secure, personalized retirement planning</p>
        </div>
        
        <div class="auth-container">
            <!-- Login Form -->
            <div id="loginForm">
                <h2 class="auth-title">Welcome Back</h2>
                <div id="authMessage"></div>
                <form class="auth-form" onsubmit="handleLogin(event)">
                    <div class="input-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="input-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="auth-btn" id="loginBtn">Sign In</button>
                </form>
                <div class="auth-switch">
                    Don't have an account? <a href="#" onclick="showRegister()">Sign up</a>
                </div>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" class="hidden">
                <h2 class="auth-title">Create Account</h2>
                <div id="registerMessage"></div>
                <form class="auth-form" onsubmit="handleRegister(event)">
                    <div class="input-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="input-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" required minlength="6">
                    </div>
                    <div class="input-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <input type="password" id="confirmPassword" required minlength="6">
                    </div>
                    <button type="submit" class="auth-btn" id="registerBtn">Create Account</button>
                </form>
                <div class="auth-switch">
                    Already have an account? <a href="#" onclick="showLogin()">Sign in</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Dashboard Section -->
    <div id="dashboardSection" class="container hidden">
        <div class="header">
            <h1>🏖️ Retirement Planning Portal</h1>
            <p>Your personalized retirement calculations</p>
            <div class="user-info">
                <span class="user-email" id="userEmail"></span>
                <button class="logout-btn" onclick="handleLogout()">Logout</button>
            </div>
        </div>
        
        <div class="dashboard">
            <div class="dashboard-header">
                <h2 class="dashboard-title">Your Calculations</h2>
                <div class="dashboard-actions">
                    <button class="btn btn-primary" onclick="showCalculator()">
                        ➕ New Calculation
                    </button>
                    <button class="btn btn-secondary" onclick="refreshDashboard()">
                        🔄 Refresh
                    </button>
                </div>
            </div>
            
            <div id="calculationsContainer">
                <div class="empty-state">
                    <div class="empty-state-icon">📊</div>
                    <h3>No calculations yet</h3>
                    <p>Create your first retirement calculation to get started!</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Calculator Section -->
    <div id="calculatorSection" class="container hidden">
        <div class="header">
            <h1>🏖️ Retirement Calculator</h1>
            <p>Plan your financial future</p>
            <div class="user-info">
                <span class="user-email" id="calcUserEmail"></span>
                <button class="logout-btn" onclick="backToDashboard()">← Back to Dashboard</button>
            </div>
        </div>
        
        <div id="calculatorContent">
            <!-- Calculator will be loaded here -->
        </div>
    </div>
    
    <!-- Supabase JS -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://znouzvccbqnaubeankos.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpub3V6dmNjYnFuYXViZWFua29zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwMzExODIsImV4cCI6MjA3MjYwNzE4Mn0.eZnmUqFYu7x_LbnkrviGt3TZkqWf0lyVIgWeTNmjNYw';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let currentUser = null;
        let calculationResults = null;
        
        // Auth Functions
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('loginBtn');
            
            loginBtn.disabled = true;
            loginBtn.textContent = 'Signing in...';
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                showMessage('authMessage', 'Login successful!', 'success');
                currentUser = data.user;
                showDashboard();
                
            } catch (error) {
                showMessage('authMessage', error.message, 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'Sign In';
            }
        }
        
        async function handleRegister(event) {
            event.preventDefault();
            
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const registerBtn = document.getElementById('registerBtn');
            
            if (password !== confirmPassword) {
                showMessage('registerMessage', 'Passwords do not match', 'error');
                return;
            }
            
            registerBtn.disabled = true;
            registerBtn.textContent = 'Creating account...';
            
            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                showMessage('registerMessage', 'Account created! Please check your email to verify your account.', 'success');
                
                // Auto switch to login after a delay
                setTimeout(() => {
                    showLogin();
                }, 3000);
                
            } catch (error) {
                showMessage('registerMessage', error.message, 'error');
            } finally {
                registerBtn.disabled = false;
                registerBtn.textContent = 'Create Account';
            }
        }
        
        async function handleLogout() {
            try {
                const { error } = await supabase.auth.signOut();
                if (error) throw error;
                
                currentUser = null;
                showAuth();
            } catch (error) {
                console.error('Logout error:', error);
            }
        }
        
        // UI Functions
        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            clearMessages();
        }
        
        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            clearMessages();
        }
        
        function showAuth() {
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('dashboardSection').classList.add('hidden');
            document.getElementById('calculatorSection').classList.add('hidden');
        }
        
        function showDashboard() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            document.getElementById('calculatorSection').classList.add('hidden');
            
            document.getElementById('userEmail').textContent = currentUser.email;
            loadCalculations();
        }
        
        function showCalculator() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.add('hidden');
            document.getElementById('calculatorSection').classList.remove('hidden');
            
            document.getElementById('calcUserEmail').textContent = currentUser.email;
            loadCalculatorContent();
        }
        
        function backToDashboard() {
            showDashboard();
        }
        
        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${type}-message">${message}</div>`;
        }
        
        function clearMessages() {
            document.getElementById('authMessage').innerHTML = '';
            document.getElementById('registerMessage').innerHTML = '';
        }
        
        // Database Functions
        async function saveCalculation(calculationData, resultsData) {
            if (!currentUser) return;
            
            try {
                const { data, error } = await supabase
                    .from('calculations')
                    .insert([{
                        user_id: currentUser.id,
                        client_name: calculationData.clientName,
                        spouse_name: calculationData.spouse?.name || null,
                        calculation_data: calculationData,
                        results_data: resultsData
                    }]);
                
                if (error) throw error;
                
                alert('Calculation saved successfully!');
                return data;
            } catch (error) {
                console.error('Save error:', error);
                alert('Error saving calculation: ' + error.message);
            }
        }
        
        async function loadCalculations() {
            if (!currentUser) return;
            
            try {
                const { data, error } = await supabase
                    .from('calculations')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                displayCalculations(data);
            } catch (error) {
                console.error('Load error:', error);
            }
        }
        
        function displayCalculations(calculations) {
            const container = document.getElementById('calculationsContainer');
            
            if (!calculations || calculations.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📊</div>
                        <h3>No calculations yet</h3>
                        <p>Create your first retirement calculation to get started!</p>
                    </div>
                `;
                return;
            }
            
            const grid = document.createElement('div');
            grid.className = 'calculations-grid';
            
            calculations.forEach(calc => {
                const card = createCalculationCard(calc);
                grid.appendChild(card);
            });
            
            container.innerHTML = '';
            container.appendChild(grid);
        }
        
        function createCalculationCard(calculation) {
            const card = document.createElement('div');
            card.className = 'calculation-card';
            
            const date = new Date(calculation.created_at).toLocaleDateString();
            const clientName = calculation.client_name || 'Unnamed';
            const spouseName = calculation.spouse_name;
            const totalIncome = calculation.results_data?.totalIncome || 0;
            
            card.innerHTML = `
                <div class="card-header">
                    <div class="card-title">${clientName}${spouseName ? ` & ${spouseName}` : ''}</div>
                    <div class="card-date">${date}</div>
                </div>
                <div class="card-info">
                    <p><strong>Age:</strong> ${calculation.calculation_data?.currentAge || 'N/A'}</p>
                    <p><strong>Retirement Age:</strong> ${calculation.calculation_data?.retirementAge || 'N/A'}</p>
                    <p><strong>Years to Retirement:</strong> ${calculation.results_data?.yearsToRetirement || 'N/A'}</p>
                </div>
                <div class="card-income">
                    $${Math.round(totalIncome).toLocaleString()}/year
                </div>
                <div class="card-actions">
                    <button class="btn btn-primary btn-small" onclick="loadCalculation(${calculation.id})">
                        📊 View Details
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="duplicateCalculation(${calculation.id})">
                        📋 Duplicate
                    </button>
                    <button class="btn btn-danger btn-small" onclick="deleteCalculation(${calculation.id})">
                        🗑️ Delete
                    </button>
                </div>
            `;
            
            return card;
        }
        
        async function deleteCalculation(id) {
            if (!confirm('Are you sure you want to delete this calculation?')) return;
            
            try {
                const { error } = await supabase
                    .from('calculations')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                loadCalculations(); // Refresh the list
            } catch (error) {
                console.error('Delete error:', error);
                alert('Error deleting calculation');
            }
        }
        
        function refreshDashboard() {
            loadCalculations();
        }
        
        // Calculator Integration
        function loadCalculatorContent() {
            const content = document.getElementById('calculatorContent');
            content.innerHTML = `
                <div style="padding: 40px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; min-height: 600px;">
                        <div id="calculatorForm">
                            <!-- Calculator form will be loaded here -->
                        </div>
                        <div id="calculatorResults">
                            <!-- Results will be shown here -->
                        </div>
                    </div>
                </div>
            `;
            
            // Load the actual calculator form
            loadCalculatorForm();
        }
        
        function loadCalculatorForm() {
            const formContainer = document.getElementById('calculatorForm');
            formContainer.innerHTML = `
                <h2 style="color: #2c3e50; margin-bottom: 25px; border-bottom: 3px solid #667eea; padding-bottom: 10px;">Personal Information</h2>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Your Full Name</label>
                    <input type="text" id="clientName" placeholder="Enter your full name" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Current Age</label>
                        <input type="number" id="currentAge" value="45" min="25" max="100" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Retirement Age</label>
                        <input type="number" id="retirementAge" value="65" min="50" max="80" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Life Expectancy</label>
                    <input type="number" id="lifeExpectancy" value="85" min="65" max="100" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                </div>
                
                <h3 style="color: #2c3e50; margin: 30px 0 20px 0; font-size: 1.3rem;">Current Savings</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Current RRSP Balance ($)</label>
                        <input type="number" id="rrsp" value="150000" min="0" step="1000" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Current TFSA Balance ($)</label>
                        <input type="number" id="tfsa" value="75000" min="0" step="1000" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Non-Registered Savings ($)</label>
                        <input type="number" id="nonReg" value="50000" min="0" step="1000" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Annual Pension Income ($)</label>
                        <input type="number" id="pensionIncome" value="12000" min="0" step="1000" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                    </div>
                </div>
                
                <h3 style="color: #2c3e50; margin: 30px 0 20px 0; font-size: 1.3rem;">Ongoing Contributions</h3>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #34495e;">Contribution Frequency</label>
                    <select id="contributionFrequency" style="width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem;">
                        <option value="monthly" selected>Monthly</option>
                        <option value="annual">Annual</option>
                    </select>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1

