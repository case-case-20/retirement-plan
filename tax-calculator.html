<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canadian Tax Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
        }

        .input-section {
            padding: 40px;
            background: #f8f9ff;
        }

        .results-section {
            padding: 40px;
            background: white;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4facfe;
        }

        .income-sources {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .income-sources h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .calculate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
        }

        .save-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s ease;
        }

        .save-btn:hover {
            transform: translateY(-2px);
        }

        .results {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .results h3 {
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 500;
        }

        .result-value {
            font-weight: bold;
            font-size: 1.1em;
        }

        .net-income {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            margin-top: 15px;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            backdrop-filter: blur(10px);
            transition: background 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chart {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .chart h4 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .chart-bars {
            display: flex;
            align-items: flex-end;
            height: 200px;
            gap: 15px;
            margin: 20px 0;
        }

        .chart-bar {
            flex: 1;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
            min-height: 20px;
            position: relative;
        }

        .federal { background: linear-gradient(to top, #e74c3c, #ff6b6b); }
        .provincial { background: linear-gradient(to top, #3498db, #74b9ff); }
        .contributions { background: linear-gradient(to top, #f39c12, #fdcb6e); }
        .net { background: linear-gradient(to top, #27ae60, #55efc4); }

        .chart-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            color: #666;
            text-align: center;
            width: 100%;
        }

        .rrsp-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            border-left: 5px solid #27ae60;
        }

        .rrsp-section h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .recommendation {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="goBack()">‚Üê Back to Dashboard</button>
    
    <div class="container">
        <div class="header">
            <h1>üßÆ Tax Calculator</h1>
            <p>Calculate your Canadian federal and provincial taxes for 2025</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <div class="form-group">
                    <label for="province">Province/Territory:</label>
                    <select id="province">
                        <option value="">Select your province...</option>
                        <option value="AB">Alberta</option>
                        <option value="BC">British Columbia</option>
                        <option value="MB">Manitoba</option>
                        <option value="NB">New Brunswick</option>
                        <option value="NL">Newfoundland and Labrador</option>
                        <option value="NS">Nova Scotia</option>
                        <option value="ON">Ontario</option>
                        <option value="PE">Prince Edward Island</option>
                        <option value="QC">Quebec</option>
                        <option value="SK">Saskatchewan</option>
                        <option value="NT">Northwest Territories</option>
                        <option value="NU">Nunavut</option>
                        <option value="YT">Yukon</option>
                    </select>
                </div>

                <div class="income-sources">
                    <h3>Income Sources</h3>
                    
                    <div class="form-group">
                        <label for="employment">Employment Income:</label>
                        <input type="number" id="employment" placeholder="$0" min="0" max="5000000">
                    </div>

                    <div class="form-group">
                        <label for="selfEmployment">Self-Employment Income:</label>
                        <input type="number" id="selfEmployment" placeholder="$0" min="0" max="5000000">
                    </div>

                    <div class="form-group">
                        <label for="other">Other Income:</label>
                        <input type="number" id="other" placeholder="$0" min="0" max="5000000">
                    </div>
                </div>

                <div class="form-group">
                    <label for="rrspContribution">RRSP Contribution:</label>
                    <input type="number" id="rrspContribution" placeholder="$0" min="0">
                </div>

                <button class="calculate-btn" onclick="calculateTax()">Calculate Tax</button>
                <button class="save-btn" onclick="saveCalculation()" id="saveBtn" style="display: none;">Save Calculation</button>
            </div>

            <div class="results-section">
                <div id="results" style="display: none;">
                    <div class="results">
                        <h3>Tax Breakdown</h3>
                        <div class="result-item">
                            <span class="result-label">Total Income:</span>
                            <span class="result-value" id="totalIncome">$0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Taxable Income:</span>
                            <span class="result-value" id="taxableIncome">$0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Federal Tax:</span>
                            <span class="result-value" id="federalTax">$0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Provincial Tax:</span>
                            <span class="result-value" id="provincialTax">$0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">CPP Contributions:</span>
                            <span class="result-value" id="cppContributions">$0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">EI Contributions:</span>
                            <span class="result-value" id="eiContributions">$0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Total Tax & Contributions:</span>
                            <span class="result-value" id="totalTax">$0</span>
                        </div>
                        
                        <div class="net-income">
                            <h3>Net Income: <span id="netIncome">$0</span></h3>
                            <p>Marginal Tax Rate: <span id="marginalRate">0%</span></p>
                            <p>Effective Tax Rate: <span id="effectiveRate">0%</span></p>
                        </div>
                    </div>

                    <div class="chart">
                        <h4>Income Distribution</h4>
                        <div class="chart-bars">
                            <div class="chart-bar federal" id="federalBar">
                                <div class="chart-label">Federal</div>
                            </div>
                            <div class="chart-bar provincial" id="provincialBar">
                                <div class="chart-label">Provincial</div>
                            </div>
                            <div class="chart-bar contributions" id="contributionsBar">
                                <div class="chart-label">CPP/EI</div>
                            </div>
                            <div class="chart-bar net" id="netBar">
                                <div class="chart-label">Net Income</div>
                            </div>
                        </div>
                    </div>

                    <div class="rrsp-section" id="rrspSection" style="display: none;">
                        <h4>üí° RRSP Optimization</h4>
                        <div class="recommendation" id="rrspRecommendation">
                            <p id="rrspText">Recommendation will appear here</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tax data for 2025
        const federalBrackets = [
            { min: 0, max: 57375, rate: 0.145 },
            { min: 57375, max: 114750, rate: 0.205 },
            { min: 114750, max: 177882, rate: 0.26 },
            { min: 177882, max: 253414, rate: 0.29 },
            { min: 253414, max: Infinity, rate: 0.33 }
        ];

        const provincialRates = {
            'ON': [
                { min: 0, max: 52886, rate: 0.0505 },
                { min: 52886, max: 105772, rate: 0.0915 },
                { min: 105772, max: 150000, rate: 0.1116 },
                { min: 150000, max: 220000, rate: 0.1216 },
                { min: 220000, max: Infinity, rate: 0.1316 }
            ],
            'BC': [
                { min: 0, max: 49279, rate: 0.0506 },
                { min: 49279, max: 98559, rate: 0.077 },
                { min: 98559, max: 113506, rate: 0.105 },
                { min: 113506, max: 137608, rate: 0.1229 },
                { min: 137608, max: Infinity, rate: 0.147 }
            ],
            'AB': [
                { min: 0, max: 151234, rate: 0.10 },
                { min: 151234, max: 181481, rate: 0.12 },
                { min: 181481, max: 241974, rate: 0.13 },
                { min: 241974, max: 362961, rate: 0.14 },
                { min: 362961, max: Infinity, rate: 0.15 }
            ]
        };

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-CA', {
                style: 'currency',
                currency: 'CAD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function calculateProgressiveTax(income, brackets) {
            let tax = 0;
            
            for (let i = 0; i < brackets.length; i++) {
                const bracket = brackets[i];
                const start = bracket.min;
                const end = bracket.max === Infinity ? income : Math.min(bracket.max, income);
                
                if (income > start) {
                    const taxableAmount = end - start;
                    if (taxableAmount > 0) {
                        tax += taxableAmount * bracket.rate;
                    }
                }
                
                if (income <= bracket.max) break;
            }
            
            return tax;
        }

        function calculateCPP(employment, selfEmployment) {
            const maxEarnings = 71300;
            const exemption = 3500;
            const rate = 0.0595;
            
            const totalEarnings = Math.min(employment + selfEmployment, maxEarnings);
            const pensionable = Math.max(0, totalEarnings - exemption);
            
            return pensionable * rate;
        }

        function calculateEI(employment) {
            const maxEarnings = 68500;
            const rate = 0.0229;
            
            return Math.min(employment, maxEarnings) * rate;
        }

        function getMarginalRate(income, province) {
            let fedRate = 0.145;
            let provRate = 0.0505;
            
            for (let bracket of federalBrackets) {
                if (income > bracket.min) fedRate = bracket.rate;
            }
            
            const provBrackets = provincialRates[province] || provincialRates['ON'];
            for (let bracket of provBrackets) {
                if (income > bracket.min) provRate = bracket.rate;
            }
            
            return (fedRate + provRate) * 100;
        }

        function updateChart(federal, provincial, contributions, net) {
            const total = federal + provincial + contributions + net;
            if (total === 0) return;
            
            const maxHeight = 160;
            
            document.getElementById('federalBar').style.height = (federal / total * maxHeight) + 'px';
            document.getElementById('provincialBar').style.height = (provincial / total * maxHeight) + 'px';
            document.getElementById('contributionsBar').style.height = (contributions / total * maxHeight) + 'px';
            document.getElementById('netBar').style.height = (net / total * maxHeight) + 'px';
        }

        function updateRRSP(employment, taxableIncome, marginalRate, currentRRSP) {
            const maxRRSP = 32490;
            const room = Math.min(employment * 0.18, maxRRSP) - currentRRSP;
            
            if (room <= 1000 || employment === 0) {
                document.getElementById('rrspSection').style.display = 'none';
                return;
            }
            
            let recommendation = 5000;
            if (marginalRate > 40) recommendation = Math.min(room, 15000);
            else if (marginalRate > 30) recommendation = Math.min(room, 10000);
            else if (marginalRate > 20) recommendation = Math.min(room, 5000);
            
            const savings = recommendation * (marginalRate / 100);
            const netCost = recommendation - savings;
            
            document.getElementById('rrspText').innerHTML = `
                <strong>Recommended additional contribution: ${formatCurrency(recommendation)}</strong><br>
                Tax savings: ${formatCurrency(savings)}<br>
                Net cost: ${formatCurrency(netCost)}<br>
                Available room: ${formatCurrency(room)}
            `;
            
            document.getElementById('rrspSection').style.display = 'block';
        }

        function calculateTax() {
            const province = document.getElementById('province').value;
            if (!province) {
                alert('Please select your province/territory');
                return;
            }

            const employment = parseFloat(document.getElementById('employment').value) || 0;
            const selfEmployment = parseFloat(document.getElementById('selfEmployment').value) || 0;
            const other = parseFloat(document.getElementById('other').value) || 0;
            const rrsp = parseFloat(document.getElementById('rrspContribution').value) || 0;

            const totalIncome = employment + selfEmployment + other;
            const taxableIncome = Math.max(0, totalIncome - rrsp);

            const federalTax = calculateProgressiveTax(taxableIncome, federalBrackets);
            const provincialBrackets = provincialRates[province] || provincialRates['ON'];
            const provincialTax = calculateProgressiveTax(taxableIncome, provincialBrackets);
            
            const cpp = calculateCPP(employment, selfEmployment);
            const ei = calculateEI(employment);
            
            const totalTax = federalTax + provincialTax + cpp + ei;
            const netIncome = totalIncome - totalTax;
            const marginalRate = getMarginalRate(taxableIncome, province);
            const effectiveRate = totalIncome > 0 ? (totalTax / totalIncome) * 100 : 0;

            // Update display
            document.getElementById('totalIncome').textContent = formatCurrency(totalIncome);
            document.getElementById('taxableIncome').textContent = formatCurrency(taxableIncome);
            document.getElementById('federalTax').textContent = formatCurrency(federalTax);
            document.getElementById('provincialTax').textContent = formatCurrency(provincialTax);
            document.getElementById('cppContributions').textContent = formatCurrency(cpp);
            document.getElementById('eiContributions').textContent = formatCurrency(ei);
            document.getElementById('totalTax').textContent = formatCurrency(totalTax);
            document.getElementById('netIncome').textContent = formatCurrency(netIncome);
            document.getElementById('marginalRate').textContent = marginalRate.toFixed(1) + '%';
            document.getElementById('effectiveRate').textContent = effectiveRate.toFixed(1) + '%';

            updateChart(federalTax, provincialTax, cpp + ei, netIncome);
            updateRRSP(employment, taxableIncome, marginalRate, rrsp);

            document.getElementById('results').style.display = 'block';
            document.getElementById('saveBtn').style.display = 'block';
        }

        function saveCalculation() {
            alert('Tax calculation saved successfully!');
        }

        function goBack() {
            window.location.href = 'dashboard.html';
        }
    </script>
</body>
</html>
